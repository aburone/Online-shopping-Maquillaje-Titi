/*! CSS critic - v0.1.0 - 2013-05-24
* http://www.github.com/cburgmer/csscritic
* Copyright (c) 2013 Christoph Burgmer, Copyright (c) 2012 ThoughtWorks, Inc.; Licensed MIT */
/* Integrated dependencies:
 * URI.js (MIT License/GPL v3),
 * cssParser.js (MPL 1.1/GPL 2.0/LGPL 2.1),
 * htmlparser.js,
 * imagediff.js (MIT License),
 * rasterizeHTML.js (MIT License) */
var CSSOM={};CSSOM.CSSStyleDeclaration=function(){this.length=0,this.parentRule=null,this._importants={}},CSSOM.CSSStyleDeclaration.prototype={constructor:CSSOM.CSSStyleDeclaration,getPropertyValue:function(e){return this[e]||""},setProperty:function(e,t,n){if(this[e]){var r=Array.prototype.indexOf.call(this,e);r<0&&(this[this.length]=e,this.length++)}else this[this.length]=e,this.length++;this[e]=t,this._importants[e]=n},removeProperty:function(e){if(e in this){var t=Array.prototype.indexOf.call(this,e);if(t<0)return"";var n=this[e];return this[e]="",Array.prototype.splice.call(this,t,1),n}return""},getPropertyCSSValue:function(){},getPropertyPriority:function(e){return this._importants[e]||""},getPropertyShorthand:function(){},isPropertyImplicit:function(){},get cssText(){var e=[];for(var t=0,n=this.length;t<n;++t){var r=this[t],i=this.getPropertyValue(r),s=this.getPropertyPriority(r);s&&(s=" !"+s),e[t]=r+": "+i+s+";"}return e.join(" ")},set cssText(e){var t,n;for(t=this.length;t--;)n=this[t],this[n]="";Array.prototype.splice.call(this,0,this.length),this._importants={};var r=CSSOM.parse("#bogus{"+e+"}").cssRules[0].style,i=r.length;for(t=0;t<i;++t)n=r[t],this.setProperty(r[t],r.getPropertyValue(n),r.getPropertyPriority(n))}},CSSOM.CSSRule=function(){this.parentRule=null,this.parentStyleSheet=null},CSSOM.CSSRule.STYLE_RULE=1,CSSOM.CSSRule.IMPORT_RULE=3,CSSOM.CSSRule.MEDIA_RULE=4,CSSOM.CSSRule.FONT_FACE_RULE=5,CSSOM.CSSRule.PAGE_RULE=6,CSSOM.CSSRule.WEBKIT_KEYFRAMES_RULE=8,CSSOM.CSSRule.WEBKIT_KEYFRAME_RULE=9,CSSOM.CSSRule.prototype={constructor:CSSOM.CSSRule},CSSOM.CSSStyleRule=function(){CSSOM.CSSRule.call(this),this.selectorText="",this.style=new CSSOM.CSSStyleDeclaration,this.style.parentRule=this},CSSOM.CSSStyleRule.prototype=new CSSOM.CSSRule,CSSOM.CSSStyleRule.prototype.constructor=CSSOM.CSSStyleRule,CSSOM.CSSStyleRule.prototype.type=1,CSSOM.CSSStyleRule.prototype.__defineGetter__("cssText",function(){var e;return this.selectorText?e=this.selectorText+" {"+this.style.cssText+"}":e="",e}),CSSOM.CSSStyleRule.prototype.__defineSetter__("cssText",function(e){var t=CSSOM.CSSStyleRule.parse(e);this.style=t.style,this.selectorText=t.selectorText}),CSSOM.CSSStyleRule.parse=function(e){var t=0,n="selector",r,i=t,s="",o={selector:!0,value:!0},u=new CSSOM.CSSStyleRule,a,f,l,c="";for(var h;h=e.charAt(t);t++)switch(h){case" ":case"	":case"\r":case"\n":case"\f":if(o[n])switch(e.charAt(t-1)){case" ":case"	":case"\r":case"\n":case"\f":break;default:s+=" "}break;case'"':i=t+1,r=e.indexOf('"',i)+1;if(!r)throw'" is missing';s+=e.slice(t,r),t=r-1;break;case"'":i=t+1,r=e.indexOf("'",i)+1;if(!r)throw"' is missing";s+=e.slice(t,r),t=r-1;break;case"/":if(e.charAt(t+1)==="*"){t+=2,r=e.indexOf("*/",t);if(r===-1)throw new SyntaxError("Missing */");t=r+1}else s+=h;break;case"{":n==="selector"&&(u.selectorText=s.trim(),s="",n="name");break;case":":n==="name"?(f=s.trim(),s="",n="value"):s+=h;break;case"!":n==="value"&&e.indexOf("!important",t)===t?(c="important",t+="important".length):s+=h;break;case";":n==="value"?(u.style.setProperty(f,s.trim(),c),c="",s="",n="name"):s+=h;break;case"}":if(n==="value")u.style.setProperty(f,s.trim(),c),c="",s="";else{if(n==="name")break;s+=h}n="selector";break;default:s+=h}return u},CSSOM.MediaList=function(){this.length=0},CSSOM.MediaList.prototype={constructor:CSSOM.MediaList,get mediaText(){return Array.prototype.join.call(this,", ")},set mediaText(e){var t=e.split(","),n=this.length=t.length;for(var r=0;r<n;r++)this[r]=t[r].trim()},appendMedium:function(e){Array.prototype.indexOf.call(this,e)===-1&&(this[this.length]=e,this.length++)},deleteMedium:function(e){var t=Array.prototype.indexOf.call(this,e);t!==-1&&Array.prototype.splice.call(this,t,1)}},CSSOM.CSSMediaRule=function(){CSSOM.CSSRule.call(this),this.media=new CSSOM.MediaList,this.cssRules=[]},CSSOM.CSSMediaRule.prototype=new CSSOM.CSSRule,CSSOM.CSSMediaRule.prototype.constructor=CSSOM.CSSMediaRule,CSSOM.CSSMediaRule.prototype.type=4,CSSOM.CSSMediaRule.prototype.__defineGetter__("cssText",function(){var e=[];for(var t=0,n=this.cssRules.length;t<n;t++)e.push(this.cssRules[t].cssText);return"@media "+this.media.mediaText+" {"+e.join("")+"}"}),CSSOM.CSSImportRule=function(){CSSOM.CSSRule.call(this),this.href="",this.media=new CSSOM.MediaList,this.styleSheet=new CSSOM.CSSStyleSheet},CSSOM.CSSImportRule.prototype=new CSSOM.CSSRule,CSSOM.CSSImportRule.prototype.constructor=CSSOM.CSSImportRule,CSSOM.CSSImportRule.prototype.type=3,CSSOM.CSSImportRule.prototype.__defineGetter__("cssText",function(){var e=this.media.mediaText;return"@import url("+this.href+")"+(e?" "+e:"")+";"}),CSSOM.CSSImportRule.prototype.__defineSetter__("cssText",function(e){var t=0,n="",r="",i,s="";for(var o;o=e.charAt(t);t++)switch(o){case" ":case"	":case"\r":case"\n":case"\f":n==="after-import"?n="url":r+=o;break;case"@":!n&&e.indexOf("@import",t)===t&&(n="after-import",t+="import".length,r="");break;case"u":if(n==="url"&&e.indexOf("url(",t)===t){i=e.indexOf(")",t+1);if(i===-1)throw t+': ")" not found';t+="url(".length;var u=e.slice(t,i);u[0]===u[u.length-1]&&(u[0]==='"'||u[0]==="'")&&(u=u.slice(1,-1)),this.href=u,t=i,n="media"}break;case'"':if(n==="url"){i=e.indexOf('"',t+1);if(!i)throw t+": '\"' not found";this.href=e.slice(t+1,i),t=i,n="media"}break;case"'":if(n==="url"){i=e.indexOf("'",t+1);if(!i)throw t+': "\'" not found';this.href=e.slice(t+1,i),t=i,n="media"}break;case";":n==="media"&&r&&(this.media.mediaText=r.trim());break;default:n==="media"&&(r+=o)}}),CSSOM.CSSFontFaceRule=function(){CSSOM.CSSRule.call(this),this.style=new CSSOM.CSSStyleDeclaration,this.style.parentRule=this},CSSOM.CSSFontFaceRule.prototype=new CSSOM.CSSRule,CSSOM.CSSFontFaceRule.prototype.constructor=CSSOM.CSSFontFaceRule,CSSOM.CSSFontFaceRule.prototype.type=5,CSSOM.CSSFontFaceRule.prototype.__defineGetter__("cssText",function(){return"@font-face {"+this.style.cssText+"}"}),CSSOM.StyleSheet=function(){this.parentStyleSheet=null},CSSOM.CSSStyleSheet=function(){CSSOM.StyleSheet.call(this),this.cssRules=[]},CSSOM.CSSStyleSheet.prototype=new CSSOM.StyleSheet,CSSOM.CSSStyleSheet.prototype.constructor=CSSOM.CSSStyleSheet,CSSOM.CSSStyleSheet.prototype.insertRule=function(e,t){if(t<0||t>this.cssRules.length)throw new RangeError("INDEX_SIZE_ERR");var n=CSSOM.parse(e).cssRules[0];return this.cssRules.splice(t,0,n),t},CSSOM.CSSStyleSheet.prototype.deleteRule=function(e){if(e<0||e>=this.cssRules.length)throw new RangeError("INDEX_SIZE_ERR");this.cssRules.splice(e,1)},CSSOM.CSSStyleSheet.prototype.toString=function(){var e="",t=this.cssRules;for(var n=0;n<t.length;n++)e+=t[n].cssText+"\n";return e},CSSOM.CSSKeyframesRule=function(){CSSOM.CSSRule.call(this),this.name="",this.cssRules=[]},CSSOM.CSSKeyframesRule.prototype=new CSSOM.CSSRule,CSSOM.CSSKeyframesRule.prototype.constructor=CSSOM.CSSKeyframesRule,CSSOM.CSSKeyframesRule.prototype.type=8,CSSOM.CSSKeyframesRule.prototype.__defineGetter__("cssText",function(){var e=[];for(var t=0,n=this.cssRules.length;t<n;t++)e.push("  "+this.cssRules[t].cssText);return"@"+(this._vendorPrefix||"")+"keyframes "+this.name+" { \n"+e.join("\n")+"\n}"}),CSSOM.CSSKeyframeRule=function(){CSSOM.CSSRule.call(this),this.keyText="",this.style=new CSSOM.CSSStyleDeclaration,this.style.parentRule=this},CSSOM.CSSKeyframeRule.prototype=new CSSOM.CSSRule,CSSOM.CSSKeyframeRule.prototype.constructor=CSSOM.CSSKeyframeRule,CSSOM.CSSKeyframeRule.prototype.type=9,CSSOM.CSSKeyframeRule.prototype.__defineGetter__("cssText",function(){return this.keyText+" {"+this.style.cssText+"} "}),CSSOM.MatcherList=function(){this.length=0},CSSOM.MatcherList.prototype={constructor:CSSOM.MatcherList,get matcherText(){return Array.prototype.join.call(this,", ")},set matcherText(e){var t=e.split(","),n=this.length=t.length;for(var r=0;r<n;r++)this[r]=t[r].trim()},appendMatcher:function(e){Array.prototype.indexOf.call(this,e)===-1&&(this[this.length]=e,this.length++)},deleteMatcher:function(e){var t=Array.prototype.indexOf.call(this,e);t!==-1&&Array.prototype.splice.call(this,t,1)}},CSSOM.CSSDocumentRule=function(){CSSOM.CSSRule.call(this),this.matcher=new CSSOM.MatcherList,this.cssRules=[]},CSSOM.CSSDocumentRule.prototype=new CSSOM.CSSRule,CSSOM.CSSDocumentRule.prototype.constructor=CSSOM.CSSDocumentRule,CSSOM.CSSDocumentRule.prototype.type=10,CSSOM.CSSDocumentRule.prototype.__defineGetter__("cssText",function(){var e=[];for(var t=0,n=this.cssRules.length;t<n;t++)e.push(this.cssRules[t].cssText);return"@-moz-document "+this.matcher.matcherText+" {"+e.join("")+"}"}),CSSOM.CSSValue=function(){},CSSOM.CSSValue.prototype={constructor:CSSOM.CSSValue,set cssText(e){var t=this._getConstructorName();throw new Exception('DOMException: property "cssText" of "'+t+'" is readonly!')},get cssText(){var e=this._getConstructorName();throw new Exception('getter "cssText" of "'+e+'" is not implemented!')},_getConstructorName:function(){var e=this.constructor.toString(),t=e.match(/function\s([^\(]+)/),n=t[1];return n}},CSSOM.CSSValueExpression=function(e,t){this._token=e,this._idx=t},CSSOM.CSSValueExpression.prototype=new CSSOM.CSSValue,CSSOM.CSSValueExpression.prototype.constructor=CSSOM.CSSValueExpression,CSSOM.CSSValueExpression.prototype.parse=function(){var e=this._token,t=this._idx,n="",r="",i="",s,o=[];for(;;++t){n=e.charAt(t);if(n==""){i="css expression error: unfinished expression!";break}switch(n){case"(":o.push(n),r+=n;break;case")":o.pop(n),r+=n;break;case"/":(s=this._parseJSComment(e,t))?s.error?i="css expression error: unfinished comment in expression!":t=s.idx:(s=this._parseJSRexExp(e,t))?(t=s.idx,r+=s.text):r+=n;break;case"'":case'"':s=this._parseJSString(e,t,n),s?(t=s.idx,r+=s.text):r+=n;break;default:r+=n}if(i)break;if(o.length==0)break}var u;return i?u={error:i}:u={idx:t,expression:r},u},CSSOM.CSSValueExpression.prototype._parseJSComment=function(e,t){var n=e.charAt(t+1),r;if(n=="/"||n=="*"){var i=t,s,o;return n=="/"?o="\n":n=="*"&&(o="*/"),s=e.indexOf(o,i+1+1),s!==-1?(s=s+o.length-1,r=e.substring(t,s+1),{idx:s,text:r}):(error="css expression error: unfinished comment in expression!",{error:error})}return!1},CSSOM.CSSValueExpression.prototype._parseJSString=function(e,t,n){var r=this._findMatchedIdx(e,t,n),i;return r===-1?!1:(i=e.substring(t,r+n.length),{idx:r,text:i})},CSSOM.CSSValueExpression.prototype._parseJSRexExp=function(e,t){var n=e.substring(0,t).trimRight(),r=[/^$/,/\($/,/\[$/,/\!$/,/\+$/,/\-$/,/\*$/,/\/\s+/,/\%$/,/\=$/,/\>$/,/\<$/,/\&$/,/\|$/,/\^$/,/\~$/,/\?$/,/\,$/,/delete$/,/in$/,/instanceof$/,/new$/,/typeof$/,/void$/],i=r.some(function(e){return e.test(n)});if(!i)return!1;var s="/";return this._parseJSString(e,t,s)},CSSOM.CSSValueExpression.prototype._findMatchedIdx=function(e,t,n){var r=t,i,s=-1;for(;;){i=e.indexOf(n,r+1);if(i===-1){i=s;break}var o=e.substring(t+1,i),u=o.match(/\\+$/);if(!u||u[0]%2==0)break;r=i}var a=e.indexOf("\n",t+1);return a<i&&(i=s),i},CSSOM.parse=function(e){var t=0,n="before-selector",r,i="",s={selector:!0,value:!0,atRule:!0,"importRule-begin":!0,importRule:!0,atBlock:!0,"documentRule-begin":!0},o=new CSSOM.CSSStyleSheet,u=o,a,f,l,c,h="",p,d,v,m,g,y,b,w=/@(-(?:\w+-)+)?keyframes/g,E=function(n){var r=e.substring(0,t).split("\n"),i=r.length,s=r.pop().length+1,u=new Error(n+" (line "+i+", char "+s+")");throw u.line=i,u.char=s,u.styleSheet=o,u};for(var S;S=e.charAt(t);t++)switch(S){case" ":case"	":case"\r":case"\n":case"\f":s[n]&&(i+=S);break;case'"':r=t+1;do r=e.indexOf('"',r)+1,r||E('Unmatched "');while(e[r-2]==="\\");i+=e.slice(t,r),t=r-1;switch(n){case"before-value":n="value";break;case"importRule-begin":n="importRule"}break;case"'":r=t+1;do r=e.indexOf("'",r)+1,r||E("Unmatched '");while(e[r-2]==="\\");i+=e.slice(t,r),t=r-1;switch(n){case"before-value":n="value";break;case"importRule-begin":n="importRule"}break;case"/":e.charAt(t+1)==="*"?(t+=2,r=e.indexOf("*/",t),r===-1?E("Missing */"):t=r+1):i+=S,n==="importRule-begin"&&(i+=" ",n="importRule");break;case"@":if(e.indexOf("@-moz-document",t)===t){n="documentRule-begin",b=new CSSOM.CSSDocumentRule,b.__starts=t,t+="-moz-document".length,i="";break}if(e.indexOf("@media",t)===t){n="atBlock",d=new CSSOM.CSSMediaRule,d.__starts=t,t+="media".length,i="";break}if(e.indexOf("@import",t)===t){n="importRule-begin",t+="import".length,i+="@import";break}if(e.indexOf("@font-face",t)===t){n="fontFaceRule-begin",t+="font-face".length,m=new CSSOM.CSSFontFaceRule,m.__starts=t,i="";break}w.lastIndex=t;var x=w.exec(e);if(x&&x.index===t){n="keyframesRule-begin",g=new CSSOM.CSSKeyframesRule,g.__starts=t,g._vendorPrefix=x[1],t+=x[0].length-1,i="";break}n=="selector"&&(n="atRule"),i+=S;break;case"{":n==="selector"||n==="atRule"?(p.selectorText=i.trim(),p.style.__starts=t,i="",n="before-name"):n==="atBlock"?(d.media.mediaText=i.trim(),u=a=d,d.parentStyleSheet=o,i="",n="before-selector"):n==="fontFaceRule-begin"?(a&&(m.parentRule=a),m.parentStyleSheet=o,p=m,i="",n="before-name"):n==="keyframesRule-begin"?(g.name=i.trim(),a&&(g.parentRule=a),g.parentStyleSheet=o,u=a=g,i="",n="keyframeRule-begin"):n==="keyframeRule-begin"?(p=new CSSOM.CSSKeyframeRule,p.keyText=i.trim(),p.__starts=t,i="",n="before-name"):n==="documentRule-begin"&&(b.matcher.matcherText=i.trim(),a&&(b.parentRule=a),u=a=b,b.parentStyleSheet=o,i="",n="before-selector");break;case":":n==="name"?(l=i.trim(),i="",n="before-value"):i+=S;break;case"(":if(n==="value")if(i.trim()=="expression"){var T=(new CSSOM.CSSValueExpression(e,t)).parse();T.error?E(T.error):(i+=T.expression,t=T.idx)}else r=e.indexOf(")",t+1),r===-1&&E('Unmatched "("'),i+=e.slice(t,r+1),t=r;else i+=S;break;case"!":n==="value"&&e.indexOf("!important",t)===t?(h="important",t+="important".length):i+=S;break;case";":switch(n){case"value":p.style.setProperty(l,i.trim(),h),h="",i="",n="before-name";break;case"atRule":i="",n="before-selector";break;case"importRule":v=new CSSOM.CSSImportRule,v.parentStyleSheet=v.styleSheet.parentStyleSheet=o,v.cssText=i+S,o.cssRules.push(v),i="",n="before-selector";break;default:i+=S}break;case"}":switch(n){case"value":p.style.setProperty(l,i.trim(),h),h="";case"before-name":case"name":p.__ends=t+1,a&&(p.parentRule=a),p.parentStyleSheet=o,u.cssRules.push(p),i="",u.constructor===CSSOM.CSSKeyframesRule?n="keyframeRule-begin":n="before-selector";break;case"keyframeRule-begin":case"before-selector":case"selector":a||E("Unexpected }"),u.__ends=t+1,o.cssRules.push(u),u=o,a=null,i="",n="before-selector"}break;default:switch(n){case"before-selector":n="selector",p=new CSSOM.CSSStyleRule,p.__starts=t;break;case"before-name":n="name";break;case"before-value":n="value";break;case"importRule-begin":n="importRule"}i+=S}return o},CSSOM.clone=function e(t){var n=new CSSOM.CSSStyleSheet,r=t.cssRules;if(!r)return n;var i={1:CSSOM.CSSStyleRule,4:CSSOM.CSSMediaRule,8:CSSOM.CSSKeyframesRule,9:CSSOM.CSSKeyframeRule};for(var s=0,o=r.length;s<o;s++){var u=r[s],a=n.cssRules[s]=new i[u.type],f=u.style;if(f){var l=a.style=new CSSOM.CSSStyleDeclaration;for(var c=0,h=f.length;c<h;c++){var p=l[c]=f[c];l[p]=f[p],l._importants[p]=f.getPropertyPriority(p)}l.length=f.length}u.hasOwnProperty("keyText")&&(a.keyText=u.keyText),u.hasOwnProperty("selectorText")&&(a.selectorText=u.selectorText),u.hasOwnProperty("mediaText")&&(a.mediaText=u.mediaText),u.hasOwnProperty("cssRules")&&(a.cssRules=e(u).cssRules)}return n},function(){function e(e){var t={},n=e.split(",");for(var r=0;r<n.length;r++)t[n[r]]=!0;return t}var t=/^<([-A-Za-z0-9_]+)((?:\s+[-A-Za-z0-9_]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,n=/^<\/([-A-Za-z0-9_]+)[^>]*>/,r=/([-A-Za-z0-9_]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,i=e("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),s=e("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul"),o=e("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),u=e("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),a=e("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),f=e("script,style"),l=this.HTMLParser=function(e,l){function c(e,t,n,f){t=t.toLowerCase();if(s[t])while(m.last()&&o[m.last()])h("",m.last());u[t]&&m.last()==t&&h("",t),f=i[t]||!!f,f||m.push(t);if(l.start){var c=[];n.replace(r,function(e,t){var n=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:a[t]?t:"";c.push({name:t,value:n,escaped:n.replace(/(^|[^\\])"/g,'$1\\"')})}),l.start&&l.start(t,c,f)}}function h(e,t){if(!t)var n=0;else for(var n=m.length-1;n>=0;n--)if(m[n]==t)break;if(n>=0){for(var r=m.length-1;r>=n;r--)l.end&&l.end(m[r]);m.length=n}}var p,d,v,m=[],g=e;m.last=function(){return this[this.length-1]};while(e){d=!0;if(!m.last()||!f[m.last()]){e.indexOf("<!--")==0?(p=e.indexOf("-->"),p>=0&&(l.comment&&l.comment(e.substring(4,p)),e=e.substring(p+3),d=!1)):e.indexOf("</")==0?(v=e.match(n),v&&(e=e.substring(v[0].length),v[0].replace(n,h),d=!1)):e.indexOf("<")==0&&(v=e.match(t),v&&(e=e.substring(v[0].length),v[0].replace(t,c),d=!1));if(d){p=e.indexOf("<");var y=p<0?e:e.substring(0,p);e=p<0?"":e.substring(p),l.chars&&l.chars(y)}}else e=e.replace(new RegExp("^((?:.|\n)*?)</"+m.last()+"[^>]*>"),function(e,t){return t=t.replace(/<!--(.*?)-->/g,"$1").replace(/<!\[CDATA\[(.*?)]]>/g,"$1"),l.chars&&l.chars(t),""}),h("",m.last());if(e==g)throw"Parse Error: "+e;g=e}h()};this.HTMLtoXML=function(e){var t="";return l(e,{start:function(e,n,r){t+="<"+e;for(var i=0;i<n.length;i++)t+=" "+n[i].name+'="'+n[i].escaped+'"';t+=(r?"/":"")+">",f[e]&&(t+="<![CDATA[\n")},end:function(e){f[e]&&(t+="\n]]>"),t+="</"+e+">"},chars:function(e){t+=e},comment:function(e){t+="<!--"+e+"-->"}}),t},this.HTMLtoDOM=function(t,n){var r=e("html,head,body,title"),i={link:"head",base:"head"};n?n=n.ownerDocument||n.getOwnerDocument&&n.getOwnerDocument()||n:typeof DOMDocument!="undefined"?n=new DOMDocument:typeof document!="undefined"&&document.implementation&&document.implementation.createDocument?n=document.implementation.createDocument("","",null):typeof ActiveX!="undefined"&&(n=new ActiveXObject("Msxml.DOMDocument"));var s=[],o=n.documentElement||n.getDocumentElement&&n.getDocumentElement();!o&&n.createElement&&function(){var e=n.createElement("html"),t=n.createElement("head");t.appendChild(n.createElement("title")),e.appendChild(t),e.appendChild(n.createElement("body")),n.appendChild(e)}();if(n.getElementsByTagName)for(var u in r)r[u]=n.getElementsByTagName(u)[0];var a=r.body;return l(t,{start:function(e,t,o){if(r[e]){a=r[e];return}var u=n.createElement(e);for(var f in t)u.setAttribute(t[f].name,t[f].value);i[e]&&typeof r[i[e]]!="boolean"?r[i[e]].appendChild(u):a&&a.appendChild&&a.appendChild(u),o||(s.push(u),a=u)},end:function(e){s.length-=1,a=s[s.length-1]},chars:function(e){a.appendChild(n.createTextNode(e))},comment:function(e){}}),n}}(),function(e){function t(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function n(e){return String(Object.prototype.toString.call(e))==="[object Array]"}function r(t,r){var i={},s,o;if(n(r))for(s=0,o=r.length;s<o;s++)i[r[s]]=!0;else i[r]=!0;for(s=0,o=t.length;s<o;s++)i[t[s]]!==e&&(t.splice(s,1),o--,s--);return t}var i=typeof module!="undefined"&&module.exports,s=function(e){return i?require("./"+e):window[e]},o=s("punycode"),u=s("IPv6"),a=s("SecondLevelDomains"),f=function(t,n){return this instanceof f?(t===e&&(t=location.href+""),this.href(t),n!==e?this.absoluteTo(n):this):new f(t)},l=f.prototype;f.idn_expression=/[^a-z0-9\.-]/i,f.punycode_expression=/(xn--)/i,f.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,f.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,f.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,f.defaultPorts={http:"80",https:"443",ftp:"21"},f.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,f.encode=encodeURIComponent,f.decode=decodeURIComponent,f.iso8859=function(){f.encode=escape,f.decode=unescape},f.unicode=function(){f.encode=encodeURIComponent,f.decode=decodeURIComponent},f.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}}},f.encodeQuery=function(e){return f.encode(e+"").replace(/%20/g,"+")},f.decodeQuery=function(e){return f.decode((e+"").replace(/\+/g,"%20"))},f.recodePath=function(e){var t=(e+"").split("/");for(var n=0,r=t.length;n<r;n++)t[n]=f.encodePathSegment(f.decode(t[n]));return t.join("/")},f.decodePath=function(e){var t=(e+"").split("/");for(var n=0,r=t.length;n<r;n++)t[n]=f.decodePathSegment(t[n]);return t.join("/")};var c={encode:"encode",decode:"decode"},h,p=function(e){return function(t){return f[e](t+"").replace(f.characters.pathname[e].expression,function(t){return f.characters.pathname[e].map[t]})}};for(h in c)f[h+"PathSegment"]=p(c[h]);f.parse=function(e){var t,n,r={};return t=e.indexOf("#"),t>-1&&(r.fragment=e.substring(t+1)||null,e=e.substring(0,t)),t=e.indexOf("?"),t>-1&&(r.query=e.substring(t+1)||null,e=e.substring(0,t)),e.substring(0,2)==="//"?(r.protocol="",e=e.substring(2),e=f.parseAuthority(e,r)):(t=e.indexOf(":"),t>-1&&(r.protocol=e.substring(0,t),e.substring(t+1,t+3)==="//"?(e=e.substring(t+3),e=f.parseAuthority(e,r)):(e=e.substring(t+1),r.urn=!0))),r.path=e,r},f.parseHost=function(e,t){var n=e.indexOf("/"),r;n===-1&&(n=e.length);if(e[0]==="["){var i=e.indexOf("]");t.hostname=e.substring(1,i)||null,t.port=e.substring(i+2,n)||null}else e.indexOf(":")!==e.lastIndexOf(":")?(t.hostname=e.substring(0,n)||null,t.port=null):(r=e.substring(0,n).split(":"),t.hostname=r[0]||null,t.port=r[1]||null);return t.hostname&&e.substring(n)[0]!=="/"&&(n++,e="/"+e),e.substring(n)||"/"},f.parseAuthority=function(e,t){return e=f.parseUserinfo(e,t),f.parseHost(e,t)},f.parseUserinfo=function(e,t){var n=e.indexOf("@"),r=e.indexOf("/"),i;return n>-1&&(r===-1||n<r)?(i=e.substring(0,n).split(":"),t.username=i[0]?f.decode(i[0]):null,t.password=i[1]?f.decode(i[1]):null,e=e.substring(n+1)):(t.username=null,t.password=null),e},f.parseQuery=function(e){if(!e)return{};e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"");if(!e)return{};var t={},n=e.split("&"),r=n.length;for(var i=0;i<r;i++){var s=n[i].split("="),o=f.decodeQuery(s.shift()),u=s.length?f.decodeQuery(s.join("=")):null;t[o]?(typeof t[o]=="string"&&(t[o]=[t[o]]),t[o].push(u)):t[o]=u}return t},f.build=function(e){var t="";return e.protocol&&(t+=e.protocol+":"),!e.urn&&(t||e.hostname)&&(t+="//"),t+=f.buildAuthority(e)||"",typeof e.path=="string"&&(e.path[0]!=="/"&&typeof e.hostname=="string"&&(t+="/"),t+=e.path),typeof e.query=="string"&&(t+="?"+e.query),typeof e.fragment=="string"&&(t+="#"+e.fragment),t},f.buildHost=function(e){var t="";return e.hostname?(f.ip6_expression.test(e.hostname)?e.port?t+="["+e.hostname+"]:"+e.port:t+=e.hostname:(t+=e.hostname,e.port&&(t+=":"+e.port)),t):""},f.buildAuthority=function(e){return f.buildUserinfo(e)+f.buildHost(e)},f.buildUserinfo=function(e){var t="";return e.username&&(t+=f.encode(e.username),e.password&&(t+=":"+f.encode(e.password)),t+="@"),t},f.buildQuery=function(t,r){var i="";for(var s in t)if(Object.hasOwnProperty.call(t,s)&&s)if(n(t[s])){var o={};for(var u=0,a=t[s].length;u<a;u++)t[s][u]!==e&&o[t[s][u]+""]===e&&(i+="&"+f.buildQueryParameter(s,t[s][u]),r!==!0&&(o[t[s][u]+""]=!0))}else t[s]!==e&&(i+="&"+f.buildQueryParameter(s,t[s]));return i.substring(1)},f.buildQueryParameter=function(e,t){return f.encodeQuery(e)+(t!==null?"="+f.encodeQuery(t):"")},f.addQuery=function(t,r,i){if(typeof r=="object")for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&f.addQuery(t,s,r[s]);else{if(typeof r!="string")throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(t[r]===e){t[r]=i;return}typeof t[r]=="string"&&(t[r]=[t[r]]),n(i)||(i=[i]),t[r]=t[r].concat(i)}},f.removeQuery=function(t,i,s){if(n(i))for(var o=0,u=i.length;o<u;o++)t[i[o]]=e;else if(typeof i=="object")for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&f.removeQuery(t,a,i[a]);else{if(typeof i!="string")throw new TypeError("URI.addQuery() accepts an object, string as the first parameter");s!==e?t[i]===s?t[i]=e:n(t[i])&&(t[i]=r(t[i],s)):t[i]=e}},f.commonPath=function(e,t){var n=Math.min(e.length,t.length),r;for(r=0;r<n;r++)if(e[r]!==t[r]){r--;break}return r<1?e[0]===t[0]&&e[0]==="/"?"/":"":(e[r]!=="/"&&(r=e.substring(0,r).lastIndexOf("/")),e.substring(0,r+1))},f.withinString=function(e,t){return e.replace(f.find_uri_expression,t)},f.ensureValidHostname=function(e){if(e.match(f.invalid_hostname_characters)){if(!o)throw new TypeError("Hostname '"+e+"' contains characters other than [A-Z0-9.-] and Punycode.js is not available");if(o.toASCII(e).match(f.invalid_hostname_characters))throw new TypeError("Hostname '"+e+"' contains characters other than [A-Z0-9.-]")}},l.build=function(t){if(t===!0)this._deferred_build=!0;else if(t===e||this._deferred_build)this._string=f.build(this._parts),this._deferred_build=!1;return this},l.toString=function(){return this.build(!1)._string},l.valueOf=function(){return this.toString()},c={protocol:"protocol",username:"username",password:"password",hostname:"hostname",port:"port"},p=function(t){return function(n,r){return n===e?this._parts[t]||"":(this._parts[t]=n,this.build(!r),this)}};for(h in c)l[h]=p(c[h]);c={query:"?",fragment:"#"},p=function(t,n){return function(r,i){return r===e?this._parts[t]||"":(r!==null&&(r+="",r[0]===n&&(r=r.substring(1))),this._parts[t]=r,this.build(!i),this)}};for(h in c)l[h]=p(h,c[h]);c={search:["?","query"],hash:["#","fragment"]},p=function(e,t){return function(n,r){var i=this[e](n,r);return typeof i=="string"&&i.length?t+i:i}};for(h in c)l[h]=p(c[h][1],c[h][0]);l.pathname=function(t,n){if(t===e||t===!0){var r=this._parts.path||(this._parts.urn?"":"/");return t?f.decodePath(r):r}return this._parts.path=t?f.recodePath(t):"/",this.build(!n),this},l.path=l.pathname,l.href=function(t,n){if(t===e)return this.toString();this._string="",this._parts={protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null};var r=t instanceof f,i=typeof t=="object"&&(t.hostname||t.path),s;if(typeof t=="string")this._parts=f.parse(t);else{if(!r&&!i)throw new TypeError("invalid input");var o=r?t._parts:t;for(s in o)Object.hasOwnProperty.call(this._parts,s)&&(this._parts[s]=o[s])}return this.build(!n),this},l.is=function(e){var t=!1,n=!1,r=!1,i=!1,s=!1,o=!1,u=!1,l=!this._parts.urn;this._parts.hostname&&(l=!1,n=f.ip4_expression.test(this._parts.hostname),r=f.ip6_expression.test(this._parts.hostname),t=n||r,i=!t,s=i&&a&&a.has(this._parts.hostname),o=i&&f.idn_expression.test(this._parts.hostname),u=i&&f.punycode_expression.test(this._parts.hostname));switch(e.toLowerCase()){case"relative":return l;case"absolute":return!l;case"domain":case"name":return i;case"sld":return s;case"ip":return t;case"ip4":case"ipv4":case"inet4":return n;case"ip6":case"ipv6":case"inet6":return r;case"idn":return o;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return u}return null};var d=l.protocol,v=l.port,m=l.hostname;l.protocol=function(t,n){if(t!==e&&t){t=t.replace(/:(\/\/)?$/,"");if(t.match(/[^a-zA-z0-9\.+-]/))throw new TypeError("Protocol '"+t+"' contains characters other than [A-Z0-9.+-]")}return d.call(this,t,n)},l.scheme=l.protocol,l.port=function(t,n){if(this._parts.urn)return t===e?"":this;if(t!==e){t===0&&(t=null);if(t){t+="",t[0]===":"&&(t=t.substring(1));if(t.match(/[^0-9]/))throw new TypeError("Port '"+t+"' contains characters other than [0-9]")}}return v.call(this,t,n)},l.hostname=function(t,n){if(this._parts.urn)return t===e?"":this;if(t!==e){var r={};f.parseHost(t,r),t=r.hostname}return m.call(this,t,n)},l.host=function(t,n){return this._parts.urn?t===e?"":this:t===e?this._parts.hostname?f.buildHost(this._parts):"":(f.parseHost(t,this._parts),this.build(!n),this)},l.authority=function(t,n){return this._parts.urn?t===e?"":this:t===e?this._parts.hostname?f.buildAuthority(this._parts):"":(f.parseAuthority(t,this._parts),this.build(!n),this)},l.userinfo=function(t,n){if(this._parts.urn)return t===e?"":this;if(t===e){if(!this._parts.username)return"";var r=f.buildUserinfo(this._parts);return r.substring(0,r.length-1)}return t[t.length-1]!=="@"&&(t+="@"),f.parseUserinfo(t,this._parts),this.build(!n),this},l.subdomain=function(n,r){if(this._parts.urn)return n===e?"":this;if(n===e){if(!this._parts.hostname||this.is("IP"))return"";var i=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,i)||""}var s=this._parts.hostname.length-this.domain().length,o=this._parts.hostname.substring(0,s),u=new RegExp("^"+t(o));return n&&n[n.length-1]!=="."&&(n+="."),n&&f.ensureValidHostname(n),this._parts.hostname=this._parts.hostname.replace(u,n),this.build(!r),this},l.domain=function(n,r){if(this._parts.urn)return n===e?"":this;typeof n=="boolean"&&(r=n,n=e);if(n===e){if(!this._parts.hostname||this.is("IP"))return"";var i=this._parts.hostname.match(/\./g);if(i&&i.length<2)return this._parts.hostname;var s=this._parts.hostname.length-this.tld(r).length-1;return s=this._parts.hostname.lastIndexOf(".",s-1)+1,this._parts.hostname.substring(s)||""}if(!n)throw new TypeError("cannot set domain empty");f.ensureValidHostname(n);if(!this._parts.hostname||this.is("IP"))this._parts.hostname=n;else{var o=new RegExp(t(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(o,n)}return this.build(!r),this},l.tld=function(n,r){if(this._parts.urn)return n===e?"":this;typeof n=="boolean"&&(r=n,n=e);if(n===e){if(!this._parts.hostname||this.is("IP"))return"";var i=this._parts.hostname.lastIndexOf("."),s=this._parts.hostname.substring(i+1);return r!==!0&&a&&a.list[s.toLowerCase()]?a.get(this._parts.hostname)||s:s}var o;if(!n)throw new TypeError("cannot set TLD empty");if(n.match(/[^a-zA-Z0-9-]/)){if(!a||!a.is(n))throw new TypeError("TLD '"+n+"' contains characters other than [A-Z0-9]");o=new RegExp(t(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(o,n)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");o=new RegExp(t(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(o,n)}return this.build(!r),this},l.directory=function(n,r){if(this._parts.urn)return n===e?"":this;if(n===e||n===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var i=this._parts.path.length-this.filename().length-1,s=this._parts.path.substring(0,i)||(this._parts.hostname?"/":"");return n?f.decodePath(s):s}var o=this._parts.path.length-this.filename().length,u=this._parts.path.substring(0,o),a=new RegExp("^"+t(u));return this.is("relative")||(n||(n="/"),n[0]!=="/"&&(n="/"+n)),n&&n[n.length-1]!=="/"&&(n+="/"),n=f.recodePath(n),this._parts.path=this._parts.path.replace(a,n),this.build(!r),this},l.filename=function(n,r){if(this._parts.urn)return n===e?"":this;if(n===e||n===!0){if(!this._parts.path||this._parts.path==="/")return"";var i=this._parts.path.lastIndexOf("/"),s=this._parts.path.substring(i+1);return n?f.decodePathSegment(s):s}var o=!1;n[0]==="/"&&(n=n.substring(1)),n.match(/\.?\//)&&(o=!0);var u=new RegExp(t(this.filename())+"$");return n=f.recodePath(n),this._parts.path=this._parts.path.replace(u,n),o?this.normalizePath(r):this.build(!r),this},l.suffix=function(n,r){if(this._parts.urn)return n===e?"":this;if(n===e||n===!0){if(!this._parts.path||this._parts.path==="/")return"";var i=this.filename(),s=i.lastIndexOf("."),o,u;return s===-1?"":(o=i.substring(s+1),u=/^[a-z0-9%]+$/i.test(o)?o:"",n?f.decodePathSegment(u):u)}n[0]==="."&&(n=n.substring(1));var a=this.suffix(),l;if(!a){if(!n)return this;this._parts.path+="."+f.recodePath(n)}else n?l=new RegExp(t(a)+"$"):l=new RegExp(t("."+a)+"$");return l&&(n=f.recodePath(n),this._parts.path=this._parts.path.replace(l,n)),this.build(!r),this};var g=l.query;l.query=function(t,n){return t===!0?f.parseQuery(this._parts.query):t!==e&&typeof t!="string"?(this._parts.query=f.buildQuery(t),this.build(!n),this):g.call(this,t,n)},l.addQuery=function(e,t,n){var r=f.parseQuery(this._parts.query);return f.addQuery(r,e,t),this._parts.query=f.buildQuery(r),typeof e!="string"&&(n=t),this.build(!n),this},l.removeQuery=function(e,t,n){var r=f.parseQuery(this._parts.query);return f.removeQuery(r,e,t),this._parts.query=f.buildQuery(r),typeof e!="string"&&(n=t),this.build(!n),this},l.addSearch=l.addQuery,l.removeSearch=l.removeQuery,l.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},l.normalizeProtocol=function(e){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!e)),this},l.normalizeHostname=function(e){return this._parts.hostname&&(this.is("IDN")&&o?this._parts.hostname=o.toASCII(this._parts.hostname):this.is("IPv6")&&u&&(this._parts.hostname=u.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!e)),this},l.normalizePort=function(e){return typeof this._parts.protocol=="string"&&this._parts.port===f.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!e)),this},l.normalizePath=function(e){if(this._parts.urn)return this;if(!this._parts.path||this._parts.path==="/")return this;var t,n,r=this._parts.path,i,s;r[0]!=="/"&&(r[0]==="."&&(n=r.substring(0,r.indexOf("/"))),t=!0,r="/"+r),r=r.replace(/(\/(\.\/)+)|\/{2,}/g,"/");for(;;){i=r.indexOf("/../");if(i===-1)break;if(i===0){r=r.substring(3);break}s=r.substring(0,i).lastIndexOf("/"),s===-1&&(s=i),r=r.substring(0,s)+r.substring(i+3)}return t&&this.is("relative")&&(n?r=n+r:r=r.substring(1)),r=f.recodePath(r),this._parts.path=r,this.build(!e),this},l.normalizePathname=l.normalizePath,l.normalizeQuery=function(e){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(f.parseQuery(this._parts.query)):this._parts.query=null,this.build(!e)),this},l.normalizeFragment=function(e){return this._parts.fragment||(this._parts.fragment=null,this.build(!e)),this},l.normalizeSearch=l.normalizeQuery,l.normalizeHash=l.normalizeFragment,l.iso8859=function(){var e=f.encode,t=f.decode;return f.encode=escape,f.decode=decodeURIComponent,this.normalize(),f.encode=e,f.decode=t,this},l.unicode=function(){var e=f.encode,t=f.decode;return f.encode=encodeURIComponent,f.decode=unescape,this.normalize(),f.encode=e,f.decode=t,this},l.readable=function(){var t=new f(this);t.username("").password("").normalize();var n="";t._parts.protocol&&(n+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&o?(n+=o.toUnicode(t._parts.hostname),t._parts.port&&(n+=":"+t._parts.port)):n+=t.host()),t._parts.hostname&&t._parts.path&&t._parts.path[0]!=="/"&&(n+="/"),n+=t.path(!0);if(t._parts.query){var r="";for(var i=0,s=t._parts.query.split("&"),u=s.length;i<u;i++){var a=(s[i]||"").split("=");r+="&"+f.decodeQuery(a[0]).replace(/&/g,"%26"),a[1]!==e&&(r+="="+f.decodeQuery(a[1]).replace(/&/g,"%26"))}n+="?"+r.substring(1)}return n+=t.hash(),n},l.absoluteTo=function(e){if(this._parts.urn)throw new Error("URNs do not have any generally defined hierachical components");e instanceof f||(e=new f(e));var t=new f(this),n=["protocol","username","password","hostname","port"],r;for(var i=0,s;s=n[i];i++)t._parts[s]=e._parts[s];return t.path()[0]!=="/"&&(r=e.directory(),t._parts.path=(r?r+"/":"")+t._parts.path,t.normalizePath()),t.build(),t},l.relativeTo=function(e){if(this._parts.urn)throw new Error("URNs do not have any generally defined hierachical components");e instanceof f||(e=new f(e));if(this.path()[0]!=="/"||e.path()[0]!=="/")throw new Error("Cannot calculate common path from non-relative URLs");var n=new f(this),r=["protocol","username","password","hostname","port"],i=f.commonPath(n.path(),e.path()),s=e.directory();for(var o=0,u;u=r[o];o++)n._parts[u]=null;if(!i||i==="/")return n;if(s+"/"===i)n._parts.path="./"+n.filename();else{var a="../",l=new RegExp("^"+t(i)),c=s.replace(l,"/").match(/\//g).length-1;while(c--)a+="../";n._parts.path=n._parts.path.replace(l,a)}return n.build(),n},l.equals=function(e){var t=new f(this),r=new f(e),i={},s={},o={},u,a,l;t.normalize(),r.normalize();if(t.toString()===r.toString())return!0;u=t.query(),a=r.query(),t.query(""),r.query("");if(t.toString()!==r.toString())return!1;if(u.length!==a.length)return!1;i=f.parseQuery(u),s=f.parseQuery(a);for(l in i)if(Object.prototype.hasOwnProperty.call(i,l)){if(!n(i[l])){if(i[l]!==s[l])return!1}else{if(!n(s[l]))return!1;if(i[l].length!==s[l].length)return!1;i[l].sort(),s[l].sort();for(var c=0,h=i[l].length;c<h;c++)if(i[l][c]!==s[l][c])return!1}o[l]=!0}for(l in s)if(Object.prototype.hasOwnProperty.call(s,l)&&!o[l])return!1;return!0},typeof module!="undefined"&&module.exports?module.exports=f:window.URI=f}(),window.rasterizeHTMLInline=function(e){"use strict";var t=function(t,n,r,i,s){var o=t.attributes.src.nodeValue,u=n||t.ownerDocument.baseURI;if(e.util.isDataUri(o)){i();return}o=e.util.getUrlRelativeToDocumentBase(o,u),e.util.getDataURIForImageURL(o,{cache:r},function(e){t.attributes.src.nodeValue=e,i()},function(){s(o)})},n=function(e){var t=[];return Array.prototype.forEach.call(e,function(e){e.type==="image"&&t.push(e)}),t};e.loadAndInlineImages=function(r,i,s){var o=e.util.parseOptionalParameters(i,s),u=r.getElementsByTagName("img"),a=r.getElementsByTagName("input"),f=o.options.baseUrl,l=o.options.cache!==!1,c=[],h=[];c=Array.prototype.slice.call(u),c=c.concat(n(a)),e.util.map(c,function(e,n){t(e,f,l,n,function(e){h.push({resourceType:"image",url:e,msg:"Unable to load image "+e}),n()})},function(){o.callback&&o.callback(h)})};var r=function(t,n,r,i,s){var o=e.css.rulesForCssText(t.textContent);e.css.loadCSSImportsForRules(o,n,r,i,function(i,u){e.css.loadAndInlineCSSResourcesForRules(o,n,r,function(n,r){var a=u.concat(r);if(i||n)t.childNodes[0].nodeValue=e.css.cssRulesToText(o);s(a)})})};e.loadAndInlineStyles=function(t,n,i){var s=e.util.parseOptionalParameters(n,i),o=t.getElementsByTagName("style"),u=s.options.baseUrl||t.baseURI,a=s.options.cache!==!1,f=[],l=[];e.util.map(o,function(e,t){!e.attributes.type||e.attributes.type.nodeValue==="text/css"?r(e,u,a,l,function(e){f=f.concat(e),t()}):t()},function(){s.callback(f)})};var i=function(e,t){var n=e.parentNode,r;t=t.trim(),t&&(r=e.ownerDocument.createElement("style"),r.type="text/css",r.appendChild(e.ownerDocument.createTextNode(t)),n.insertBefore(r,e)),n.removeChild(e)},s=function(t,n,r,i,s){var o=t.attributes.href.nodeValue,u=n||t.ownerDocument.baseURI,a=e.util.getUrlRelativeToDocumentBase(o,u);e.util.ajax(a,{cache:r},function(t){var n=e.css.rulesForCssText(t),s;s=e.css.adjustPathsOfCssResources(o,n),e.css.loadCSSImportsForRules(n,u,r,[],function(o,a){e.css.loadAndInlineCSSResourcesForRules(n,u,r,function(r,u){var f=a.concat(u);if(s||o||r)t=e.css.cssRulesToText(n);i(t,f)})})},function(){s(a)})};e.loadAndInlineCssLinks=function(t,n,r){var o=e.util.parseOptionalParameters(n,r),u=t.getElementsByTagName("link"),a=o.options.baseUrl,f=o.options.cache!==!1,l=[];e.util.map(u,function(e,t){e.attributes.rel&&e.attributes.rel.nodeValue==="stylesheet"&&(!e.attributes.type||e.attributes.type.nodeValue==="text/css")?s(e,a,f,function(n,r){i(e,n+"\n"),l=l.concat(r),t()},function(e){l.push({resourceType:"stylesheet",url:e,msg:"Unable to load stylesheet "+e}),t()}):t()},function(){o.callback&&o.callback(l)})};var o=function(t,n,r,i,s){var o=n||t.ownerDocument.baseURI,u=e.util.getUrlRelativeToDocumentBase(t.attributes.src.nodeValue,o);e.util.ajax(u,{cache:r},i,function(){s(u)})},u=function(e,t){var n=e.ownerDocument.createElement("script"),r=e.parentNode;e.attributes.type&&(n.type=e.attributes.type.nodeValue),n.appendChild(e.ownerDocument.createTextNode(t)),r.insertBefore(n,e),r.removeChild(e)};return e.loadAndInlineScript=function(t,n,r){var i=e.util.parseOptionalParameters(n,r),s=t.getElementsByTagName("script"),a=i.options.cache!==!1,f=[];e.util.map(s,function(e,t){e.attributes.src?o(e,i.options.baseUrl,a,function(n){u(e,n),t()},function(e){f.push({resourceType:"script",url:e,msg:"Unable to load script "+e}),t()}):t()},function(){i.callback&&i.callback(f)})},e.inlineReferences=function(t,n,r){var i=[];e.loadAndInlineImages(t,n,function(s){i=i.concat(s),e.loadAndInlineStyles(t,n,function(s){i=i.concat(s),e.loadAndInlineCssLinks(t,n,function(s){i=i.concat(s),e.loadAndInlineScript(t,n,function(e){i=i.concat(e),r(i)})})})})},e}(window.rasterizeHTMLInline||{}),window.rasterizeHTMLInline=function(e,t,n){"use strict";e.css={};var r=function(e){return Array.prototype.slice.call(e)},i=function(e){var t=document.implementation.createHTMLDocument(""),n=document.createElement("style"),i;return n.textContent=e,t.body.appendChild(n),i=n.sheet.cssRules,r(i)};e.css.rulesForCssText=function(e){return n.parse&&t.navigator.userAgent.indexOf("Chrome")>=0?n.parse(e).cssRules:i(e)};var s=function(e){var n=[];return e.forEach(function(e){e.type===t.CSSRule.STYLE_RULE&&(e.style.getPropertyValue("background-image")||e.style.getPropertyValue("background"))&&n.push(e)}),n},o=function(e){var n=[];return e.forEach(function(e){e.type===t.CSSRule.FONT_FACE_RULE&&e.style.getPropertyValue("src")&&n.push(e)}),n};e.css.cssRulesToText=function(e){var t="";return e.forEach(function(e){t+=e.cssText}),t};var u=function(e){var t=/^"(.*)"$/,n=/^'(.*)'$/;return t.test(e)?e.replace(t,"$1"):n.test(e)?e.replace(n,"$1"):e},a=function(e){var t=/^[\t\r\f\n ]*(.+?)[\t\r\f\n ]*$/;return e.replace(t,"$1")};e.css.extractCssUrl=function(e){var t=/^url\(([^\)]+)\)/,n;if(!t.test(e))throw new Error("Invalid url");return n=t.exec(e)[1],u(a(n))};var f=function(e){var t=/^format\(([^\)]+)\)/,n;return t.test(e)?(n=t.exec(e)[1],u(n)):null},l=function(t){var n,r=null;try{return n=e.css.extractCssUrl(t[0]),t[1]&&(r=f(t[1])),{url:n,format:r}}catch(i){}},c=function(e,t,n){var r=e.indexOf(t),i="@font-face { font-family: "+t.style.getPropertyValue("font-family")+"; src: "+n+"}",s=t.parentStyleSheet;s.insertRule(i,r+1),s.deleteRule(r),e[r]=s.cssRules[r]};e.css.adjustPathsOfCssResources=function(t,n){var r=!1,i;return s(n).forEach(function(n){var s=n.style.getPropertyValue("background-image")||n.style.getPropertyValue("background"),o=m(s),u=!1;o.forEach(function(n){var r=g(n),i;r&&!e.util.isDataUri(r.url)&&(i=e.util.joinUrl(t,r.url),n[r.idx]='url("'+i+'")',u=!0)}),i=y(o),n.style.getPropertyValue("background-image")?n.style.setProperty("background-image",i):n.style.setProperty("background",i),r=r||u}),o(n).forEach(function(i){var s=E(i.style.getPropertyValue("src")),o=!1;s.forEach(function(n){var r=l(n),i;r&&!e.util.isDataUri(r.url)&&(i=e.util.joinUrl(t,r.url),n[0]='url("'+i+'")',o=!0)}),o&&c(n,i,S(s)),r=r||o}),r};var h=function(e){var n=[];return e.forEach(function(e){e.type===t.CSSRule.IMPORT_RULE&&e.href&&n.push(e)}),n},p=function(e,t,n){var r=e.indexOf(t);e.splice(r,1),n.forEach(function(t,n){e.splice(r+n,0,t)})},d=function(e){var t=/^"(.*)"$/,n=/^'(.*)'$/;return t.test(e)||n.test(e)},v=function(t,n,r,i,s,o,a){var f=n.href,l;d(f)&&(f=u(f)),l=e.util.getUrlRelativeToDocumentBase(f,r);if(s.indexOf(l)>=0){p(t,n,[]),o([]);return}s.push(l),e.util.ajax(l,{cache:i},function(u){var a=e.css.rulesForCssText(u);e.css.loadCSSImportsForRules(a,r,i,s,function(r,i){e.css.adjustPathsOfCssResources(f,a),p(t,n,a),o(i)})},function(){a(l)})};e.css.loadCSSImportsForRules=function(t,n,r,i,s){var o=[],u;u=h(t),e.util.map(u,function(e,s){v(t,e,n,r,i,function(e){o=o.concat(e),s(!0)},function(e){o.push({resourceType:"stylesheet",url:e,msg:"Unable to load stylesheet "+e}),s(!1)})},function(e){var t=e.indexOf(!0)>=0;s(t,o)})};var m=function(e){var t="\\s*(?:\"[^\"]*\"|'[^']*'|[^\\(]+)\\s*",n="(url\\("+t+"\\)"+"|"+"[^,\\s]+"+")",r="(?:\\s*"+n+")+",i="^\\s*("+r+")"+"(?:\\s*,\\s*("+r+"))*"+"\\s*$",s=new RegExp(r,"g"),o,u=[],a=function(e){var t=new RegExp(n,"g"),r=[],i;i=t.exec(e);while(i)r.push(i[1]),i=t.exec(e);return r};if(e.match(new RegExp(i))){o=s.exec(e);while(o)u.push(a(o[0])),o=s.exec(e);return u}return[]},g=function(t){var n,r;for(n=0;n<t.length;n++)try{return r=e.css.extractCssUrl(t[n]),{url:r,idx:n}}catch(i){}},y=function(e){var t=[];return e.forEach(function(e){t.push(e.join(" "))}),t.join(", ")},b=function(t,n,r,i){var s=[],o,u=t.style.getPropertyValue("background-image")||t.style.getPropertyValue("background"),a;o=m(u),e.util.map(o,function(t,i){var o=g(t),u;if(!o||e.util.isDataUri(o.url)){i(!1);return}u=e.util.getUrlRelativeToDocumentBase(o.url,n),e.util.getDataURIForImageURL(u,{cache:r},function(e){t[o.idx]='url("'+e+'")',i(!0)},function(){s.push(u),i(!1)})},function(e){var n=e.indexOf(!0)>=0;n&&(a=y(o),t.style.getPropertyValue("background-image")?t.style.setProperty("background-image",a):t.style.setProperty("background",a)),i(n,s)})},w=function(t,n,r,i){var o=s(t),u=[],a;e.util.map(o,function(e,t){b(e,n,r,function(e,n){n.forEach(function(e){u.push({resourceType:"backgroundImage",url:e,msg:"Unable to load background-image "+e})}),t(e)})},function(e){a=e.indexOf(!0)>=0,i(a,u)})},E=function(e){var t="\\s*(?:\"[^\"]*\"|'[^']*'|[^\\(]+)\\s*",n="(local\\("+t+"\\))"+"|"+"(url\\("+t+"\\))"+"(?:\\s+(format\\("+t+"\\)))?",r="^\\s*("+n+")"+"(?:\\s*,\\s*("+n+"))*"+"\\s*$",i=new RegExp(n,"g"),s,o=[],u=function(e){var t=[];return e.slice(1).forEach(function(e){e&&t.push(e)}),t};if(e.match(new RegExp(r))){s=i.exec(e);while(s)o.push(u(s)),s=i.exec(e);return o}return[]},S=function(e){var t=[];return e.forEach(function(e){t.push(e.join(" "))}),t.join(", ")},x=function(t,n,r,i,s){var o,u,a,f,h,p=[];o=E(n.style.getPropertyValue("src")),e.util.map(o,function(t,n){u=l(t);if(!u||e.util.isDataUri(u.url)){n(!1);return}a=e.util.getUrlRelativeToDocumentBase(u.url,r),f=u.format||"woff",e.util.binaryAjax(a,{cache:i},function(e){h=btoa(e),t[0]='url("data:font/'+f+";base64,"+h+'")',n(!0)},function(){p.push(a),n(!1)})},function(e){var r=e.indexOf(!0)>=0;r&&c(t,n,S(o)),s(r,p)})},T=function(t,n,r,i){var s=o(t),u=[],a;e.util.map(s,function(e,i){x(t,e,n,r,function(e,t){t.forEach(function(e){u.push({resourceType:"fontFace",url:e,msg:"Unable to load font-face "+e})}),i(e)})},function(e){a=e.indexOf(!0)>=0,i(a,u)})};return e.css.loadAndInlineCSSResourcesForRules=function(e,t,n,r){w(e,t,n,function(i,s){T(e,t,n,function(e,t){var n=i||e;r(n,s.concat(t))})})},e}(window.rasterizeHTMLInline||{},window,window.CSSOM||{}),window.rasterizeHTMLInline=function(e,t,n){"use strict";e.util={},e.util.getUrlRelativeToDocumentBase=function(t,n){return n&&n!=="about:blank"&&(t=e.util.joinUrl(n,t)),t},e.util.cloneArray=function(e){return Array.prototype.slice.apply(e,[0])},e.util.joinUrl=function(e,t){var r=new n(t);return r.is("relative")&&(r=r.absoluteTo(e)),r.toString()},e.util.isDataUri=function(e){return/^data:/.test(e)},e.util.map=function(t,n,r){var i=0,s=e.util.cloneArray(t),o=[],u;s.length===0&&r(o);var a=function(e){function t(t){i+=1,o[e]=t,i===s.length&&r(o)}n(s[e],t)};for(u=0;u<s.length;u++)a(u)};var r=null,i=function(e,t,n){if(t){if(r===null||!n)r=Date.now();return e+"?_="+r}return e};e.util.ajax=function(e,n,r,s){var o=new t.XMLHttpRequest,u;n=n||{},u=i(e,n.cache===!1,n.cacheRepeated),o.addEventListener("load",function(){o.status===200||o.status===0?r(o.response):s()},!1),o.addEventListener("error",function(){s()},!1);try{o.open("GET",u,!0),o.overrideMimeType(n.mimeType),o.send(null)}catch(a){s()}},e.util.binaryAjax=function(t,n,r,i){var s="";n=n||{},e.util.ajax(t,{mimeType:"text/plain; charset=x-user-defined",cache:n.cache},function(e){for(var t=0;t<e.length;t++)s+=String.fromCharCode(e.charCodeAt(t)&255);r(s)},i)};var s=function(e){var t=function(e,t){return e.substring(0,t.length)===t};return t(e,"<?xml")||t(e,"<svg")?"image/svg+xml":"image/png"};e.util.getDataURIForImageURL=function(t,n,r,i){var o,u;e.util.binaryAjax(t,n,function(e){o=btoa(e),u=s(e),r("data:"+u+";base64,"+o)},function(){i()})};var o=function(e){var t={},n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},u=function(e){return typeof e=="function"};return e.util.parseOptionalParameters=function(){var e={options:{},callback:null};return u(arguments[0])?e.callback=arguments[0]:(e.options=o(arguments[0]),e.callback=arguments[1]||null),e},e}(window.rasterizeHTMLInline||{},window,URI),window.rasterizeHTML=function(e,t,n){"use strict";var r={},i=[];r.util={},r.util.getConstantUniqueIdFor=function(e){return i.indexOf(e)<0&&i.push(e),i.indexOf(e)},r.util.log=function(e){n.console&&n.console.log&&n.console.log(e)};var s=function(e){var t={},n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},o=function(e){return typeof e=="object"&&e!==null},u=function(e){return o(e)&&Object.prototype.toString.apply(e).match(/\[object (Canvas|HTMLCanvasElement)\]/i)},a=function(e){return typeof e=="function"};r.util.parseOptionalParameters=function(){var e={canvas:null,options:{},callback:null};return a(arguments[0])?e.callback=arguments[0]:arguments[0]==null||u(arguments[0])?(e.canvas=arguments[0]||null,a(arguments[1])?e.callback=arguments[1]:(e.options=s(arguments[1]),e.callback=arguments[2]||null)):(e.options=s(arguments[0]),e.callback=arguments[1]||null),e};var f=function(e){return(""+function(e){window.parent.rasterizeHTML.util.reportIframeJsError("put_unique_id_here",e)}).replace("put_unique_id_here",e)},l={};r.util.reportIframeJsError=function(e,t){var n=l[e]||[];n.push(t),l[e]=n};var c=function(e){var t=[];return l[e]&&l[e].forEach(function(e){t.push({resourceType:"scriptExecution",msg:e})}),t};r.util.executeJavascript=function(e,t,i){var s=y(n.document,"iframe"),o=e.getElementsByTagName("html")[0].innerHTML,u=r.util.getConstantUniqueIdFor(e),a="<script>window.onerror = "+f(u)+";</script>",l=function(){var e=s.contentDocument;n.document.getElementsByTagName("body")[0].removeChild(s),i(e,c(u))};t>0?s.onload=function(){setTimeout(l,t)}:s.onload=l,s.contentDocument.open(),s.contentDocument.write("<html>"+a+o+"</html>"),s.contentDocument.close()};var h=function(){return n.navigator.userAgent.indexOf("WebKit")>=0},p=function(e){var i;return e.documentElement.setAttribute("xmlns",e.documentElement.namespaceURI),i=(new n.XMLSerializer).serializeToString(e.documentElement),h()?t?t(i):(r.util.log("Looks like your browser needs htmlparser.js as workaround for writing XML. Please include it."),i):i},d=function(){if(n.navigator.userAgent.indexOf("WebKit")>=0&&n.navigator.userAgent.indexOf("Chrome")<0)return!1;if(n.BlobBuilder||n.MozBlobBuilder||n.WebKitBlobBuilder)return!0;if(n.Blob)try{return new n.Blob(["<b></b>"],{type:"text/xml"}),!0}catch(e){return!1}return!1},v=function(e){var t="image/svg+xml;charset=utf-8",r=n.BlobBuilder||n.MozBlobBuilder||n.WebKitBlobBuilder,i;return r?(i=new r,i.append(e),i.getBlob(t)):new n.Blob([e],{type:t})},m=function(e){var t=n.URL||n.webkitURL||window;return d()?t.createObjectURL(v(e)):"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(e)},g=function(e){var t=n.URL||n.webkitURL||window;d()&&t.revokeObjectURL(e)},y=function(e,t){var n=e.createElement(t);return n.style.visibility="hidden",n.style.width="0px",n.style.height="0px",n.style.position="absolute",n.style.top="-10000px",n.style.left="-10000px",e.getElementsByTagName("body")[0].appendChild(n),n},b=function(e,t){var n=e.getElementById(t);return n||(n=y(e,"div"),n.id=t),n},w="rasterizeHTML_js_FirefoxWorkaround",E=function(){var e=n.navigator.userAgent.match(/Firefox\/(\d+).0/);return!e||!e[1]||parseInt(e[1],10)<17},S=function(e,t){var i=r.util.getConstantUniqueIdFor(e),s=t?t.ownerDocument:n.document,o;E()&&(o=b(s,w+i),o.innerHTML=e,o.className=w)},x=function(e){window.navigator.userAgent.indexOf("WebKit")>=0&&Array.prototype.forEach.call(e.getElementsByTagName("style"),function(e){e.textContent="span {}\n"+e.textContent})},T=function(e,t){var i=r.util.getConstantUniqueIdFor(e),s=t?t.ownerDocument:n.document,o=s.getElementById(w+i);o&&o.parentNode.removeChild(o)};r.getSvgForDocument=function(e,t,n){var r;return x(e),r=p(e),'<svg xmlns="http://www.w3.org/2000/svg" width="'+t+'" height="'+n+'">'+'<foreignObject width="100%" height="100%">'+r+"</foreignObject>"+"</svg>"},r.renderSvg=function(e,t,r,i){var s,o,u=function(){o.onload=null,o.onerror=null},a=function(){s&&g(s),T(e,t)};S(e,t),s=m(e),o=new n.Image,o.onload=function(){u(),a(),r(o)},o.onerror=function(){a(),i()},o.src=s},r.drawImageOnCanvas=function(e,t){try{t.getContext("2d").drawImage(e,0,0)}catch(n){return!1}return!0};var N=function(e,t,n,i,s,o){var u=r.getSvgForDocument(e,t,n),a=function(e){e.push({resourceType:"document",msg:"Error rendering page"})},f;r.renderSvg(u,i,function(e){i&&(f=r.drawImageOnCanvas(e,i),f||(a(o),e=null)),s&&s(e,o)},function(){a(o),s&&s(null,o)})};return r.drawDocument=function(t,n,i,s){var o=r.util.parseOptionalParameters(n,i,s),u=o.canvas?o.canvas.width:300,a=o.canvas?o.canvas.height:200,f=o.options.width!==undefined?o.options.width:u,l=o.options.height!==undefined?o.options.height:a,c=o.options.executeJsTimeout||0;e.inlineReferences(t,o.options,function(e){o.options.executeJs?r.util.executeJavascript(t,c,function(t,n){N(t,f,l,o.canvas,o.callback,e.concat(n))}):N(t,f,l,o.canvas,o.callback,e)})},r.drawHTML=function(e,t,i,s){var o=r.util.parseOptionalParameters(t,i,s),u=n.document.implementation.createHTMLDocument("");u.documentElement.innerHTML=e,r.drawDocument(u,o.canvas,o.options,o.callback)},r.drawURL=function(t,n,i,s){var o=r.util.parseOptionalParameters(n,i,s),u=o.options.cache;o.options.baseUrl=t,e.util.ajax(t,{cache:u},function(e){r.drawHTML(e,o.canvas,o.options,o.callback)},function(){o.callback&&o.callback(null,[{resourceType:"page",url:t,msg:"Unable to load page "+t}])})},r}(window.rasterizeHTMLInline,window.HTMLtoXML,window),function(e,t){var n=this;if(typeof module!="undefined"){var r=require("canvas");module.exports=t(n,e,r)}else typeof define=="function"&&typeof define.amd=="object"?define(t):n[e]=t(n,e)}("imagediff",function(e,t,n){function d(e,t){var r=n?new n:document.createElement("canvas");return e&&(r.width=e),t&&(r.height=t),r}function v(e,t){return f.width=e,f.height=t,l.clearRect(0,0,e,t),l.createImageData(e,t)}function m(e){return E(e,o)}function g(e){return E(e,i)}function y(e){return E(e,s)}function b(e){return!!e&&!!E(e,u)&&typeof e.width!==a&&typeof e.height!==a&&typeof e.data!==a}function w(e){return m(e)||g(e)||y(e)||b(e)}function E(e,t){return typeof e=="object"&&!!Object.prototype.toString.apply(e).match(t)}function S(e){var t=e.height,n=e.width,r=e.data,i,s,o;f.width=n,f.height=t,i=l.getImageData(0,0,n,t),s=i.data;for(o=e.data.length;o--;)s[o]=r[o];return i}function x(e){if(m(e))return T(e);if(g(e))return N(e);if(y(e))return C(e);if(b(e))return e}function T(e){var t=e.height,n=e.width;return f.width=n,f.height=t,l.clearRect(0,0,n,t),l.drawImage(e,0,0),l.getImageData(0,0,n,t)}function N(e){var t=e.height,n=e.width,r=e.getContext("2d");return r.getImageData(0,0,n,t)}function C(e){var t=e.canvas,n=t.height,r=t.width;return e.getImageData(0,0,r,n)}function k(e){var t=x(e),n=d(t.width,t.height),r=n.getContext("2d");return r.putImageData(t,0,0),n}function L(e,t){return e.width===t.width}function A(e,t){return e.height===t.height}function O(e,t){return A(e,t)&&L(e,t)}function M(e,t,n){var r=e.data,i=t.data,s=r.length,o;n=n||0;if(!O(e,t))return!1;for(o=s;o--;)if(r[o]!==i[o]&&Math.abs(r[o]-i[o])>n)return!1;return!0}function _(e,t){return(O(e,t)?D:P)(e,t)}function D(e,t){var n=e.height,r=e.width,i=v(r,n),s=e.data,o=t.data,u=i.data,a=u.length,f,l,c,h,p,d;for(c=0;c<a;c+=4)u[c]=Math.abs(s[c]-o[c]),u[c+1]=Math.abs(s[c+1]-o[c+1]),u[c+2]=Math.abs(s[c+2]-o[c+2]),u[c+3]=Math.abs(255-s[c+3]-o[c+3]);return i}function P(e,t){function g(e){a=Math.floor((n-e.height)/2),f=Math.floor((r-e.width)/2)}var n=Math.max(e.height,t.height),r=Math.max(e.width,t.width),i=v(r,n),s=e.data,o=t.data,u=i.data,a,f,l,c,h,p,d,m;for(h=u.length-1;h>0;h-=4)u[h]=255;g(e);for(l=e.height;l--;)for(c=e.width;c--;)h=4*((l+a)*r+(c+f)),p=4*(l*e.width+c),u[h+0]=s[p+0],u[h+1]=s[p+1],u[h+2]=s[p+2];g(t);for(l=t.height;l--;)for(c=t.width;c--;)h=4*((l+a)*r+(c+f)),p=4*(l*t.width+c),u[h+0]=Math.abs(u[h+0]-o[p+0]),u[h+1]=Math.abs(u[h+1]-o[p+1]),u[h+2]=Math.abs(u[h+2]-o[p+2]);return i}function H(){var e;for(e=0;e<arguments.length;e++)if(!w(arguments[e]))throw{name:"ImageTypeError",message:"Submitted object was not an image."}}function B(e,t){return e=document.createElement(e),e&&t&&(e.innerHTML=t),e}function j(e,t,n){var r=k(e),i,s;n=n||Function,i=r.toDataURL().replace(/^data:image\/\w+;base64,/,""),s=new Buffer(i,"base64"),require("fs").writeFile(t,s,n)}var r=/\[object Array\]/i,i=/\[object (Canvas|HTMLCanvasElement)\]/i,s=/\[object CanvasRenderingContext2D\]/i,o=/\[object (Image|HTMLImageElement)\]/i,u=/\[object ImageData\]/i,a="undefined",f=d(),l=f.getContext("2d"),c=e[t],h,p;return p={toBeImageData:function(){return h.isImageData(this.actual)},toImageDiffEqual:function(e,t){return typeof document!==a&&(this.message=function(){var t=B("div"),n=B("div","<div>Actual:</div>"),r=B("div","<div>Expected:</div>"),i=B("div","<div>Diff:</div>"),s=h.diff(this.actual,e),o=d(),u;return o.height=s.height,o.width=s.width,u=o.getContext("2d"),u.putImageData(s,0,0),n.appendChild(k(this.actual)),r.appendChild(k(e)),i.appendChild(o),t.appendChild(n),t.appendChild(r),t.appendChild(i),[t,"Expected not to be equal."]}),h.equal(this.actual,e,t)}},h={createCanvas:d,createImageData:v,isImage:m,isCanvas:g,isContext:y,isImageData:b,isImageType:w,toImageData:function(e){return H(e),b(e)?S(e):x(e)},equal:function(e,t,n){return H(e,t),e=x(e),t=x(t),M(e,t,n)},diff:function(e,t){return H(e,t),e=x(e),t=x(t),_(e,t)},jasmine:p,noConflict:function(){return e[t]=c,h}},typeof module!="undefined"&&(h.imageDataToPNG=j),h}),window.csscritic=function(e){e.util={},e.util.getDataURIForImage=function(e){var t=window.document.createElement("canvas"),n=t.getContext("2d");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),t.toDataURL("image/png")},e.util.getImageForUrl=function(e,t,n){var r=new window.Image;r.onload=function(){t(r)},n&&(r.onerror=n),r.src=e},e.util.getImageForBinaryContent=function(e,t){var n=new window.Image;n.onload=function(){t(n)},n.onerror=function(){t(null)},n.src="data:image/png;base64,"+btoa(e)};var t=function(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)&255);return t},n=function(e){return e+"?_="+Date.now()};e.util.ajax=function(e,r,i){var s=new XMLHttpRequest;s.onload=function(){s.status===200||s.status===0?r(t(s.response)):i()},s.onerror=function(){i()};try{s.open("get",n(e),!0),s.overrideMimeType("text/plain; charset=x-user-defined"),s.send()}catch(o){i()}},e.util.workAroundTransparencyIssueInFirefox=function(t,n){var r;try{r=e.util.getDataURIForImage(t)}catch(i){n(t);return}e.util.getImageForUrl(r,function(e){n(e)})},e.util.map=function(e,t,n){var r=0,i=[],s;e.length===0&&n(i);var o=function(s){function o(t){r+=1,i[s]=t,r===e.length&&n(i)}t(e[s],o)};for(s=0;s<e.length;s++)o(s)},e.util.queue={};var r=[],i=!1,s=function(){var e;r.length>0?(i=!0,e=r.shift(),e(s)):i=!1};return e.util.queue.execute=function(e){r.push(e),i||s()},e.util.queue.clear=function(){r=[],i=!1},e}(window.csscritic||{}),window.csscritic=function(e,t){e.renderer=e.renderer||{};var n=function(e){var t=[];return e.forEach(function(e){e.url&&t.push(e.url)}),t},r=function(r,i,s,o,u,a){e.util.queue.execute(function(e){t.drawHTML(i,{cache:!1,width:s,height:o,executeJs:!0,executeJsTimeout:50,baseUrl:r},function(t,r){var i=r===undefined?[]:n(r);t?u(t,i):a(),e()})})};return e.renderer.browserRenderer=function(t,n,i,s,o,u){var a=t;s&&(a=s+"/inline?url="+t),e.util.ajax(a,function(t){e.util.getImageForBinaryContent(t,function(e){e?o(e,[]):r(a,t,n,i,function(e,t){o(e,t)},function(){u&&u()})})},function(){u&&u()})},e.renderer.getImageForPageUrl=e.renderer.browserRenderer,e}(window.csscritic||{},rasterizeHTML),window.csscritic=function(e,t){return e.storage=e.storage||{},e.domstorage={},e.domstorage.storeReferenceImage=function(n,r){var i,s;try{i=e.util.getDataURIForImage(r)}catch(o){throw window.alert("An error occurred reading the canvas. Are you sure you are using Firefox?\n"+o),o}s={referenceImageUri:i},t.setItem(n,JSON.stringify(s))},e.domstorage.readReferenceImage=function(n,r,i){var s=t.getItem(n),o;s?(o=JSON.parse(s),e.util.getImageForUrl(o.referenceImageUri,function(e){r(e)},i)):i()},e.storage.storeReferenceImage=e.domstorage.storeReferenceImage,e.storage.readReferenceImage=e.domstorage.readReferenceImage,e}(window.csscritic||{},localStorage),window.csscritic=function(e,t,n,r,i){var s,o,u,a=function(){s=[],o=[],u=null};a(),e.setProxy=function(e){u=e};var f=function(e,r,i,s,o){var a={status:e,pageUrl:r,pageImage:i};return i&&(a.resizePageImage=function(e,n,i){t.getImageForPageUrl(r,e,n,u,function(e){a.pageImage=e,i(e)})},a.acceptPage=function(){n.storeReferenceImage(r,a.pageImage)}),s&&(a.referenceImage=s),o&&o.length&&(a.erroneousPageUrls=o),a},l=function(t,n){e.util.map(t,function(t,n){e.util.map(s,function(e,n){e.reportComparisonStarting?e.reportComparisonStarting({pageUrl:t},n):n()},n)},n)},c=function(e,t,n,r,i,o){var u,a,l=0,c=s.length,h=function(){l+=1,l===c&&o()};if(!c){o();return}a=f(e,t,n,r,i);for(u=0;u<c;u++)s[u].reportComparison(a,h)},h=function(t,n){e.util.map(s,function(e,n){e.report?e.report({success:t},n):n()},n)};e.addReporter=function(e){s.push(e)},e.clearReporters=function(){s=[]};var p=function(e,t){t&&i.diff(e,t)},d=function(n,r,s,o,a){t.getImageForPageUrl(n,r,s,u,function(t,r){var s,u;p(t,o),e.util.workAroundTransparencyIssueInFirefox(t,function(e){o?(s=i.equal(e,o),u=s?"passed":"failed"):u="referenceMissing",c(u,n,t,o,r,function(){a&&a(u)})})},function(){var e="error";c(e,n,null,null,null,function(){a&&a(e)})})};return e.compare=function(e,t){n.readReferenceImage(e,function(n){d(e,n.width,n.height,n,t)},function(){d(e,800,600,null,t)})},e.add=function(e){o.push(e)},e.execute=function(t){l(o,function(){e.util.map(o,function(t,n){e.compare(t,function(e){n(e==="passed")})},function(e){var n=e.indexOf(!1)===-1;h(n,function(){t&&t(n)})})})},e.clear=a,e}(window.csscritic||{},window.csscritic.renderer,window.csscritic.storage,window,imagediff),window.csscritic=function(e,t){e.basicHTMLReporterUtil={};var n=function(e){var n=t.createElement("canvas"),r;return n.height=e.height,n.width=e.width,r=n.getContext("2d"),r.putImageData(e,0,0),n};e.basicHTMLReporterUtil.getDifferenceCanvas=function(e,t){var r=imagediff.diff(e,t);return n(r)};var r=function(e){var t=Math.log(256);return Math.floor(255*Math.log(e+1)/t)};e.basicHTMLReporterUtil.getHighlightedDifferenceCanvas=function(e,t){var i=imagediff.diff(e,t);for(var s=0;s<i.data.length;s++)s%4<3&&(i.data[s]=r(i.data[s]));return n(i)};var i=function(e,t){var n=e.style.width,r=e.style.height;e.onmouseup=function(){if(n!==e.style.width||r!==e.style.height)n=e.style.width,r=e.style.height,t(n,r)}},s=function(){var e="csscritic_basichtmlreporter",n=t.getElementById(e),r;return n===null&&(n=t.createElement("div"),n.id=e,r=t.createElement("div"),r.className="timeTaken",n.appendChild(r),t.getElementsByTagName("body")[0].appendChild(n)),n},o=function(e,n){var r=t.createElement("div"),s=t.createElement("div"),o=t.createElement("div"),u;return s.className="pageImageContainer",s.style.width=e.pageImage.width+"px",s.style.height=e.pageImage.height+"px",n&&(u=t.createElement("span"),u.className="caption",u.textContent="Page",r.appendChild(u)),o.className="innerPageImageContainer",o.appendChild(e.pageImage),s.appendChild(o),i(s,function(){var t=parseInt(s.style.width,10),n=parseInt(s.style.height,10),r=e.pageImage;e.resizePageImage(t,n,function(e){o.removeChild(r),o.appendChild(e)})}),r.className="outerPageImageContainer",r.appendChild(s),r},u=function(e){var n=t.createElement("div"),r=t.createElement("div"),i=t.createElement("span");return r.className="referenceImageContainer",r.appendChild(e.referenceImage),i.className="caption",i.textContent="Reference",n.className="outerReferenceImageContainer",n.appendChild(i),n.appendChild(r),n},a=function(){var e=t.createElement("span");return e.className="finished",e.style.display="none",e},f=function(e){var n=t.createElement("div"),r=t.createElement("button"),i=a();return r.onclick=function(){e.acceptPage(),i.style.display=""},r.textContent="Accept the rendered page",n.className="saveHint warning",n.appendChild(r),n.appendChild(t.createTextNode("and save this as later reference.")),n.appendChild(i),n},l=function(e){var n=t.createElement("div"),r=t.createElement("button"),i=a();return r.onclick=function(){e.acceptPage(),i.style.display=""},r.textContent="accept the rendered page",n.className="updateHint warning",n.appendChild(t.createTextNode("You can")),n.appendChild(r),n.appendChild(t.createTextNode("thus making it the new reference.")),n.appendChild(i),n},c=function(e){var n=t.createElement("div"),r=t.createElement("ul");return n.className="loadErrors warning",n.appendChild(t.createTextNode("Could not load the referenced resources:")),n.appendChild(r),e.erroneousPageUrls.forEach(function(e){var n=t.createElement("li");n.textContent=e,r.appendChild(n)}),n.appendChild(t.createTextNode("Make sure the paths lie within the same origin as this document.")),n},h=function(e){var n=t.createElement("div");return n.className="errorMsg warning",n.textContent="The page '"+e.pageUrl+"' could not be rendered. Make sure the path lies within the same origin as this document.",n},p=function(n){var r=t.createElement("div"),i=t.createElement("div"),s=e.basicHTMLReporterUtil.getDifferenceCanvas(n.pageImage,n.referenceImage),o=e.basicHTMLReporterUtil.getHighlightedDifferenceCanvas(n.pageImage,n.referenceImage);return r.className="differenceCanvasContainer",i.className="innerDifferenceCanvasContainer",r.appendChild(i),s.className="differenceCanvas",i.appendChild(s),o.className="highlightedDifferenceCanvas",i.appendChild(o),r},d=function(e){var n=t.createElement("span");return n.className="status",e.status==="passed"?n.textContent="passed":e.status==="failed"?n.textContent="failed":e.status==="referenceMissing"?n.textContent="missing reference":e.status==="error"&&(n.textContent="error"),n},v=function(e){var n=t.createElement("a");return n.className="pageUrl",n.textContent=e.pageUrl,n.href=e.pageUrl,n},m=function(e){var n=t.getElementById(e);return n||(n=t.createElement("div"),n.id=e,n.style.display="none",n.style.position="absolute",t.getElementsByTagName("body")[0].appendChild(n)),n},g=function(e){while(e.hasChildNodes())e.removeChild(e.lastChild)},y=function(e,t){e.onmouseover=function(e){var n=m("csscritic_basichtmlreporter_tooltip"),r=t.referenceImage;g(n),n.style.display="block",n.style.top=e.pageY+10+"px",n.style.left=e.pageX+10+"px",n.appendChild(r)},e.onmousemove=function(e){var t=m("csscritic_basichtmlreporter_tooltip");t.style.top=e.pageY+10+"px",t.style.left=e.pageX+10+"px"},e.onmouseout=function(){var e=m("csscritic_basichtmlreporter_tooltip");e.style.display="none"}},b=function(e,t){e.className+=" "+t.status,e.appendChild(d(t)),t.erroneousPageUrls&&e.appendChild(c(t)),t.status==="failed"?(e.appendChild(p(t)),e.appendChild(o(t,!0)),e.appendChild(u(t)),e.appendChild(l(t))):t.status==="referenceMissing"?(e.appendChild(f(t)),e.appendChild(o(t))):t.status==="error"?e.appendChild(h(t)):t.status==="passed"&&y(e,t)},w=function(e){var n=t.createElement("div");return n.className="comparison running",n.appendChild(v(e)),n},E=function(e,t){t.className=t.className.replace(" running",""),b(t,e)},S=function(e,t){e+="";while(e.length<t)e="0"+e;return e},x=function(e){var t=Math.floor(e/1e3),n=e%1e3;return t+"."+S(n,3)};return e.BasicHTMLReporter=function(){var e={},t=null;return{reportComparisonStarting:function(n,r){var i=w(n),o=s();t===null&&(t=Date.now()),o.appendChild(i),e[n.pageUrl]=i,r&&r()},reportComparison:function(t,n){var r=e[t.pageUrl];r||(r=w(t),s().appendChild(r)),E(t,r),n&&n()},report:function(){var e=s(),n=t===null?0:Date.now()-t,r=e.getElementsByClassName("timeTaken")[0];r.textContent="finished in "+x(n)+"s"}}},e}(window.csscritic||{},window.document);