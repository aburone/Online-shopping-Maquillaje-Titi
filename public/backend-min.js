$(document).ready(function(){el=document.querySelectorAll(".ajax_hide_on_click");for(var d=0;d<el.length;d++){el[d].addEventListener("click",function(){this.classList.add("hide")},false)}$(".ajax_click_to_edit_sku").editable("/admin/products/ajax_update",{indicator:"Actualizando...",tooltip:"Click para editar...",width:230,submitdata:{"function":"update_sku"}});if($(".quicksearch tbody tr").length>0){var l=$(".quicksearch"),m=l.data("quicksearch")=="no_focus"?"":"autoselect",c=l.data("label")?l.data("label"):"Set me with data-label";$(".quicksearch tbody tr").quicksearch({attached:".quicksearch",position:"before",labelText:c,inputText:"",inputClass:m,delay:300})}$(".ajax_confirm").click(function(){var i=confirm($(this).data("confirm_message"));return i});$(".ajax_hide_items").click(function(){$(".items").hide("slow")});$(".toggle_me").hide();$(".toggle_link").click(function(i){$(this).next(".toggle_me").toggle("slow");$(this).toggleClass("current").focus()});$(".ajax_filter_by_me").click(function(){var i=$(this).html().trim(),n=$(".quicksearch input");n.val(i);n.focus()});$(".autoselect").focus().select();$(".tablesorter").tablesorter();$("input[name=i_id]").attr("autocomplete","off");$("a.edit").focusin(function(){$(this).closest("tr").addClass("item_hover")}).focusout(function(){$(this).closest("tr").removeClass("item_hover")}).click(function(){$(this).closest("tr").removeClass("item_hover")});$(".ajax_item").click(function(){window.location.href=$(this).find("a").attr("href")});$(".flash.notice").parent().addClass("flash_notice");$(".flash").hover(function(){$(this).addClass("bounceOutUp")});setTimeout(function(){$(".flash_notice").addClass("bounceOutUp")},5000);setTimeout(function(){$(".flash_warning").addClass("bounceOutUp")},10000);var f=document.querySelector("#ajax_add_distributor");f.addEventListener("change",function(){var n=new XMLHttpRequest();var i="/admin/products/"+this.dataset.p_id+"/ajax_add_distributor/"+this.value;var o=this.dataset.csrfKey+"="+encodeURIComponent(this.dataset.csrfToken);n.open("POST",i,true);n.setRequestHeader("Content-type","application/x-www-form-urlencoded");n.onreadystatechange=function(){if(n.readyState==4&&n.status==200){var p=document.querySelector("#ajax_product_distributors");p.innerHTML=n.responseText;f.value=""}};n.send(o)},false);function k(o){var i=document.querySelector("#ajax_product_distributors");i.innerHTML="";var n=JSON.parse(o);i.appendChild(b("âš« "+JSON.parse(n[d]).d_name))}function b(n){var i=document.createElement("p");i.appendChild(document.createTextNode(n));return i}$(".edit_bulk").click(function(o){o.preventDefault();o.stopPropagation();var n=$(this).closest("tr"),i="/admin/bulks/"+o.target.dataset.b_id;$.ajax({type:"GET",url:i,beforeSend:function(){n.html('<td colspan="6" class="loading"><img src="/media/loading.gif" alt="Cargando..." /></td>')},success:function(p){n.html(p);$("[autofocus]").focus().select()},error:function(){$("#ajax_panel").html('<p class="error"><strong>Oops!</strong> Proba denuevo.</p>')}})});$("form").on("keyup","select[name=b_status]",function(i){if(i.keyCode==13){$(this).closest("form").submit()}});$("input[type=tel].number.positive").on({focus:function(i){original=this.value},keyup:function(i){if(~this.value.indexOf("-")){this.value=this.value.replace(/[\-]/g,"")}if(!g(this.value)){this.value=original}}});$("form").on("keyup","#ajax_product_buy_cost",function(i){e()});$("#ajax_product_price").on({focus:function(i){original_price=document.getElementById("ajax_product_price").value},keyup:function(i){if(this.value.length>0&&this.value!=original_price){e();j()}}});function g(i){return parseFloat(i.replace(/[\,]/g,"."))==Number(i.replace(/[\,]/g,"."))}function a(i){return Number(i.replace(/[\,]/g,"."))}function e(){buy_cost=document.getElementById("ajax_product_buy_cost");parts_cost=document.getElementById("ajax_product_parts_cost");materials_cost=document.getElementById("ajax_product_materials_cost");sale_cost=document.getElementById("ajax_product_sale_cost");ideal_markup=document.getElementById("ajax_product_ideal_markup");real_markup=document.getElementById("ajax_product_real_markup");price=document.getElementById("ajax_product_price");var p=a(price.value)/(a(buy_cost.value)+a(parts_cost.value)+a(materials_cost.value));var o=Math.round(p*1000)/1000;real_markup.value=o;if(ideal_markup.value==""||ideal_markup.value==0||ideal_markup.value==Infinity||ideal_markup.value==NaN){ideal_markup.value=real_markup.value}var n=a(buy_cost.value)+a(parts_cost.value)+a(materials_cost.value);var i=Math.round(n*1000)/1000;sale_cost.value=i}function j(){exact_price=document.getElementById("ajax_product_exact_price");price=document.getElementById("ajax_product_price");exact_price.value=price.value}$(".ajax_void_item").click(function(r){r.preventDefault();r.stopPropagation();var o=confirm($(this).data("confirm_message"));if(o==false){return false}var q=$(".ajax_response");var i=$(this).closest("form").attr("action");var n=$(this).siblings("input[name=csrf]").attr("value");var p=$(this).siblings("input[name=i_id]").attr("value");$.ajax({type:"POST",url:i,data:{csrf:n},beforeSend:function(){q.html('<div class="loading"><img src="/media/loading.gif" alt="Cargando..." /></div>')},success:function(w){$(".flash").hide("slow");q.html(w);var v=$("td:contains("+p+")");v.parent("tr").hide("slow");var t=v.closest("table").find(".counter");var s=t.html().trim();var u=parseInt(s,10);t.html(s.replace(u,u-1));$("[autofocus]").focus().select()},error:function(){q.html('<p class="error"><strong>Oops!</strong> Proba denuevo.</p>')}})});function h(){$(".persist_area").each(function(){var i=$(this),o=i.offset(),n=$(window).scrollTop();if((n>o.top)&&(n<o.top+i.height())){$(".persist_header:not([class*='floating_header'])",i).addClass("floating_header")}else{$(".persist_header",i).removeClass("floating_header")}})}$(function(){$(".persist_area").each(function(){floating_header=$(".persist_header",this);floating_header.css("width",$(this).width())});$(window).scroll(h).trigger("scroll")})});